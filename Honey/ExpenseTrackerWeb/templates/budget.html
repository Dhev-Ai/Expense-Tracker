{% extends 'base.html' %} {% block title %}Budget - Expense Tracker{% endblock
%} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold mb-0">
    <i class="bi bi-piggy-bank me-2"></i> Budget Manager
  </h2>
  <button
    class="btn btn-primary"
    data-bs-toggle="modal"
    data-bs-target="#addBudgetModal"
  >
    <i class="bi bi-plus-lg me-1"></i> Set Budget
  </button>
</div>

<!-- Budget Cards -->
{% if budgets %}
<div class="row g-4">
  {% for budget in budgets %} {% set pct = (budget.spent / budget.budget_amount
  * 100) if budget.budget_amount > 0 else 0 %} {% set remaining =
  budget.budget_amount - budget.spent %}
  <div class="col-md-6 col-lg-4">
    <div class="card h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start mb-3">
          <div>
            <span
              class="badge mb-2"
              style="background: {{ budget.color or '#667EEA' }};"
            >
              {{ budget.icon or 'ðŸ“¦' }} {{ budget.category_name }}
            </span>
            <h5 class="fw-bold mb-0">
              â‚¹{{ "%.0f"|format(budget.budget_amount) }}
            </h5>
            <small class="text-secondary">Monthly budget</small>
          </div>
          <div class="text-end">
            {% if pct >= 100 %}
            <span class="badge bg-danger">Over Budget!</span>
            {% elif pct >= 80 %}
            <span class="badge bg-warning">Warning</span>
            {% else %}
            <span class="badge bg-success">On Track</span>
            {% endif %}
          </div>
        </div>

        <div class="mb-3">
          <div class="d-flex justify-content-between mb-1 small">
            <span>Spent: â‚¹{{ "%.0f"|format(budget.spent) }}</span>
            <span>{{ "%.0f"|format(pct) }}%</span>
          </div>
          <div class="progress" style="height: 12px">
            <div
              class="progress-bar {% if pct >= 100 %}bg-danger{% elif pct >= 80 %}bg-warning{% else %}bg-success{% endif %}"
              style="width: {{ pct if pct <= 100 else 100 }}%;"
            ></div>
          </div>
        </div>

        <div class="d-flex justify-content-between">
          <div>
            <small class="text-secondary">Remaining</small>
            <div
              class="fw-bold {% if remaining < 0 %}text-danger{% else %}text-success{% endif %}"
            >
              â‚¹{{ "%.0f"|format(remaining if remaining > 0 else 0) }}
            </div>
          </div>
          <div class="text-end">
            <small class="text-secondary">Daily Limit</small>
            <div class="fw-bold">
              {% set days_left = 30 %} â‚¹{{ "%.0f"|format(remaining / days_left
              if remaining > 0 and days_left > 0 else 0) }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="card">
  <div class="card-body text-center py-5">
    <i
      class="bi bi-piggy-bank"
      style="font-size: 4rem; color: var(--primary)"
    ></i>
    <h4 class="mt-3">No Budgets Set</h4>
    <p class="text-secondary">
      Start managing your money by setting category budgets
    </p>
    <button
      class="btn btn-primary"
      data-bs-toggle="modal"
      data-bs-target="#addBudgetModal"
    >
      <i class="bi bi-plus-lg me-1"></i> Set Your First Budget
    </button>
  </div>
</div>
{% endif %}

<!-- Budget Tips -->
<div class="card mt-4">
  <div class="card-header">
    <i class="bi bi-lightbulb me-2"></i> Budget Tips
  </div>
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-4">
        <div class="d-flex align-items-start">
          <span style="font-size: 2rem">ðŸ“Š</span>
          <div class="ms-3">
            <h6 class="mb-1">50/30/20 Rule</h6>
            <small class="text-secondary"
              >50% needs, 30% wants, 20% savings</small
            >
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="d-flex align-items-start">
          <span style="font-size: 2rem">ðŸŽ¯</span>
          <div class="ms-3">
            <h6 class="mb-1">Track Daily</h6>
            <small class="text-secondary">Record expenses as they happen</small>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="d-flex align-items-start">
          <span style="font-size: 2rem">ðŸ’°</span>
          <div class="ms-3">
            <h6 class="mb-1">Review Weekly</h6>
            <small class="text-secondary">Check progress every week</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Budget Modal -->
<div class="modal fade" id="addBudgetModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content" style="background: var(--bg-card)">
      <div class="modal-header border-0">
        <h5 class="modal-title">
          <i class="bi bi-plus-circle me-2"></i> Set Budget
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <form method="POST" action="{{ url_for('add_budget') }}">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select name="category_id" class="form-select" required>
              <option value="">Select category...</option>
              {% for cat in categories %}
              <option value="{{ cat.category_id }}">
                {{ cat.category_name }}
              </option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Budget Amount (â‚¹)</label>
            <input
              type="number"
              name="amount"
              class="form-control"
              placeholder="Enter monthly budget"
              min="0"
              step="100"
              required
            />
          </div>
        </div>
        <div class="modal-footer border-0">
          <button
            type="button"
            class="btn btn-outline-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">Save Budget</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

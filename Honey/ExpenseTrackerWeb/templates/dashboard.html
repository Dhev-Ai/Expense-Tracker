{% extends 'base.html' %} {% block title %}Dashboard - Expense Tracker{%
endblock %} {% block content %}
<!-- Welcome Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="fw-bold mb-1">
      ðŸ‘‹ Hello, {{ current_user.full_name.split()[0] }}!
    </h2>
    <p class="text-secondary mb-0">Here's your expense summary</p>
  </div>
  <a href="{{ url_for('add_expense') }}" class="btn btn-primary">
    <i class="bi bi-plus-lg me-1"></i> Add Expense
  </a>
</div>

<!-- Stats Cards -->
<div class="row g-3 mb-4">
  <div class="col-6 col-md-3">
    <div class="stat-card">
      <div class="stat-label">
        <i class="bi bi-cash-stack me-1"></i> Total Spent
      </div>
      <div class="stat-value">â‚¹{{ "%.0f"|format(stats.total or 0) }}</div>
      <small>This month</small>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="stat-card success">
      <div class="stat-label">
        <i class="bi bi-receipt me-1"></i> Transactions
      </div>
      <div class="stat-value">{{ stats.count or 0 }}</div>
      <small>This month</small>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="stat-card warning">
      <div class="stat-label"><i class="bi bi-graph-up me-1"></i> Average</div>
      <div class="stat-value">â‚¹{{ "%.0f"|format(stats.avg or 0) }}</div>
      <small>Per expense</small>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="stat-card danger">
      <div class="stat-label">
        <i class="bi bi-arrow-up-circle me-1"></i> Highest
      </div>
      <div class="stat-value">â‚¹{{ "%.0f"|format(stats.max or 0) }}</div>
      <small>Single expense</small>
    </div>
  </div>
</div>

<div class="row g-4">
  <!-- Pie Chart -->
  <div class="col-md-6">
    <div class="card h-100">
      <div
        class="card-header d-flex justify-content-between align-items-center"
      >
        <span><i class="bi bi-pie-chart me-2"></i> Spending by Category</span>
      </div>
      <div class="card-body">
        {% if category_data %}
        <div class="chart-container">
          <canvas id="categoryChart"></canvas>
        </div>
        {% else %}
        <div class="text-center py-5 text-secondary">
          <i class="bi bi-inbox" style="font-size: 3rem"></i>
          <p class="mt-2">No expenses this month</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Recent Expenses -->
  <div class="col-md-6">
    <div class="card h-100">
      <div
        class="card-header d-flex justify-content-between align-items-center"
      >
        <span><i class="bi bi-clock-history me-2"></i> Recent Expenses</span>
        <a href="{{ url_for('expenses') }}" class="btn btn-sm btn-outline-light"
          >View All</a
        >
      </div>
      <div class="card-body">
        {% if recent_expenses %} {% for expense in recent_expenses %}
        <div class="expense-item">
          <div class="d-flex align-items-center">
            <div
              class="expense-icon"
              style="background: {{ expense.color or '#667EEA' }}20;"
            >
              {{ expense.icon or 'ðŸ“¦' }}
            </div>
            <div>
              <div class="fw-semibold">
                {{ expense.description or 'No description' }}
              </div>
              <small class="text-secondary">
                {{ expense.category_name or 'Uncategorized' }} â€¢ {{
                expense.expense_date }}
              </small>
            </div>
          </div>
          <div class="expense-amount">
            -â‚¹{{ "%.0f"|format(expense.amount) }}
          </div>
        </div>
        {% endfor %} {% else %}
        <div class="text-center py-5 text-secondary">
          <i class="bi bi-inbox" style="font-size: 3rem"></i>
          <p class="mt-2">No expenses yet</p>
          <a href="{{ url_for('add_expense') }}" class="btn btn-primary btn-sm">
            Add your first expense
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Category Breakdown -->
{% if category_data %}
<div class="card mt-4">
  <div class="card-header">
    <i class="bi bi-list-ul me-2"></i> Category Breakdown
  </div>
  <div class="card-body">
    {% set total = namespace(value=0) %} {% for cat in category_data %} {% set
    total.value = total.value + cat.total %} {% endfor %} {% for cat in
    category_data %} {% set pct = (cat.total / total.value * 100) if total.value
    > 0 else 0 %}
    <div class="mb-3">
      <div class="d-flex justify-content-between mb-1">
        <span>{{ cat.icon or 'ðŸ“¦' }} {{ cat.category_name }}</span>
        <span class="fw-semibold"
          >â‚¹{{ "%.0f"|format(cat.total) }} ({{ "%.1f"|format(pct) }}%)</span
        >
      </div>
      <div class="progress">
        <div
          class="progress-bar"
          role="progressbar"
          style="width: {{ pct }}%; background: {{ cat.color or '#667EEA' }};"
        ></div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %} {% endblock %} {% block scripts %}
<script>
  {% if category_data %}
  // Pie Chart
  const ctx = document.getElementById('categoryChart').getContext('2d');
  new Chart(ctx, {
      type: 'doughnut',
      data: {
          labels: [{% for cat in category_data %}'{{ cat.category_name }}'{% if not loop.last %},{% endif %}{% endfor %}],
          datasets: [{
              data: [{% for cat in category_data %}{{ cat.total }}{% if not loop.last %},{% endif %}{% endfor %}],
              backgroundColor: [{% for cat in category_data %}'{{ cat.color or "#667EEA" }}'{% if not loop.last %},{% endif %}{% endfor %}],
              borderWidth: 0
          }]
      },
      options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '60%',
          plugins: {
              legend: {
                  position: 'bottom',
                  labels: {
                      color: '#A0AEC0',
                      padding: 15
                  }
              }
          }
      }
  });
  {% endif %}
</script>
{% endblock %}
